#!/bin/bash
#
#  backlight
#
#  Backlight control for i3wm.
#
#  Requires:
#	proper setting of udev rules relative to brightness with intel card
#

# Get the backlight as a percentage.
get_backlight() {
	cat /sys/class/backlight/intel_backlight/brightness
}


# Increase brightness relative to current value.
#
# Arguments:
#   Step        (integer) Percentage to increase by.

write_val() {
	echo $1 > /sys/class/backlight/intel_backlight/brightness
}

raise_backlight() {
	old_val=$(get_backlight) 
	val=$((old_val + step))
	echo $val
	write_val $val
}


# Decrease brightness relative to current value.
#
# Arguments:
#   Step        (integer) Percentage to decrease by.
lower_backlight() {
	old_val=$(get_backlight)
	val=$((old_val - step))
	echo $val
	write_val $val
}


# Set brightness.
#
# Arguments:
#   Step        (integer) Percentage to set.
set_backlight() {
	max=`cat /sys/class/backlight/intel_backlight/max_brightness`
	val=$(((max / 100) * $1))
   	write_val $val
	echo $val
}


# Display program usage.
usage() {
    echo "Usage: $0 [options]
Control brightness and related notifications.

Options:
  -d <amount>       decrease volume
  -i <amount>       increase volume
  -v <value>        set volume
  -h                display this help and exit
" 1>&2
    exit 1
}
###########################################################

opt_decrease_backlight=false
opt_increase_backlight=false
opt_notification=false
opt_set_backlight=false
step=10000
backlight_set="120000"

while getopts ":ac:d:e:hi:lmnps:t:u:v:y" o; do
    case "$o" in
        d)
            opt_decrease_backlight=true
            step="${OPTARG}"
            ;;
        i)
            opt_increase_backlight=true
            step="${OPTARG}"
            ;;
        v)
            opt_set_backlight=true
            backlight_set="${OPTARG}"
            ;;
        h | *)
            usage
            ;;
    esac
done
shift $((OPTIND-1)) # Shift off options and optional --

if ${opt_increase_backlight}; then
    raise_backlight $step
fi

if ${opt_decrease_backlight}; then
    lower_backlight $step
fi

if ${opt_set_backlight}; then
    set_backlight $backlight_set
fi
